---
title: 路由相关知识
toc: true
recommend: 1
uniqueId: '2021-04-11 06:59:00/about-route.html'
mathJax: false
date: 2021-04-11 14:59:00
thumbnail:
tags:
categories: [计算机网络,Cisco]
keywords:
---
> **当两个不同得网段需要通信时, 就会需要路由器**.
>
> 路由到其他网络的方法又分为**静态**和**动态**, 一个路由器上也可以存在两种配置
>
> - 动态需要占用额外的带宽, 存在一定安全隐患, 但易维护
> - 静态适合小型网络
> - 当静态和动态冲突时, 会选择两者之中**管理距离**最小(AD)的转发

<!-- more -->

## 静态路由

> 配置: `ip route`
>
> 查看: 
>
> - `show ip route`
>
> - `show ip route static`
>
> - `show ip route 网络`
>
> **IPv6**必须配置`ipv6 unicast-routing`全局配置命令, 将上面的ip换成ipv6

### 默认静态路由

> 如果一台路由器仅有另外一台路由器与之相连，在这种情况下，路由器称为末节路由器。
>
> 末节路由器和边缘路由器通常采用默认静态路由

- 默认静态路由仅是 0.0.0.0/0 作为目标 IPv4 地址的静态路由。

### 汇总静态路由

- 对于多条连续的网络条目, 可以将其汇总成一条减少路由条目数量

```shell
172.20.0.0/16
172.21.0.0/16
172.22.0.0/16
172.23.0.0/16
|
v
172.20.0.0/14
```

### 浮动静态路由

相当于备用路由, 管理距离要比静态/动态的大

### 跳选项

> **CEF**（思科快速转发）是运行 **IOS 12.0** 或更高版本的大多数平台的默认行为
>
> 使用 CEF 时不需要完全指定静态路由。应采用使用下一跳地址的静态路由。

路由分为以下三种类型：

**下一跳路由** - 仅指定下一跳 IP 地址

- 指定后不可避免的就是递归查找(耗费资源)
- IOS 12.0使用了CEF, 避免了递归查找

**直连静态路由** - 仅指定路由器退出接口

**完全指定静态路由** - 指定下一跳 IP 地址和退出接口

- 早期IOS规避递归查找的办法


## 动态路由

> 动态路由协议自上个世纪八十年代后期开始应用于网络。RIP 是第一批路由协议中的一个.
>
> RIP 协议更新为 RIPv2 以适应网络环境的发展。 但是，RIPv2 仍无法扩展以适应当今的大型网络实施。 为了满足大型网络的需要，两种高级路由协议应运而生：开放最短路径优先协议 (OSPF) 和中间系统到中间系统协议 (IS-IS)。思科也推出了面向大型网络实施的“内部网关路由协议”(IGRP) 和增强型 IGRP (EIGRP) 协议
>
> 此外，需要连接不同的网际网络并在它们之间提供路由。边界网关协议 (BGP) 当前用于互联网服务提供商 (ISPs) 之间。 BGP 还用于 ISP 与其较大的私有客户端之间来交换路由信息。

动态路由协议的主要组件包括：

- **数据结构** - 路由协议通常使用路由表或数据库来完成路由过程。此类信息保存在内存中。

- **路由协议消息** - 路由协议使用各种消息找出邻近的路由器，交换路由信息，并通过其他一些任务来获取和维护准确的网络信息。

- **算法** - 算法是指用于完成某个任务的一定数量的步骤。路由协议使用算法获取路由信息并确定最佳路径。

## 路由条目

![](https://cdn.jsdelivr.net/gh/yangchaohe/yangchaohe.github.io@static/img/article/2021/route-item.png)

> 优先选择最长的子网掩码的路由，如果有多条路由，则匹配管理距离，管理距离小的路由优先，如果管理距离相同，在匹配度量值，度量值小的优先，如果度量值相同，则选择负载均衡，具体的方式看采用哪种路由协议和相关的配置了。

### 术语

- **最终路由** - 最终路由是包含下一跳 IPv4 地址或送出接口的路由表条目。动态获知的直连本地路由为最终路由

- **一级路由** - 1 级路由是指子网掩码等于或小于网络地址有类掩码的路由. 比如

  - **网络路由** - 是指子网掩码等于有类掩码的路由。

  - **超网路由** - 是指掩码小于有类掩码（例如，汇总地址）的网络地址。

  - **默认路由** - 是指地址为 0.0.0.0/0 的静态路由。
  - 一级路由可以是最终路由

- **一级父路由** - 父路由是划分子网的 1 级网络路由。父路由不可以是最终路由
- **二级子路由** - 2 级子路由是指有类网络地址的子网路由